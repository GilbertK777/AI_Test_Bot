# 상세 테스트 계획서

이 문서는 트레이딩 봇의 안정적인 운영을 위해, 각 기능을 단계별로 검증하는 방법을 구체적으로 기술합니다. 초보자도 쉽게 따라 할 수 있도록 각 테스트의 목표와 방법을 상세히 설명합니다.

---

## Phase 1: 환경 설정 및 데이터 검증 (가장 기본)

> **목표**: 프로그램 실행의 가장 기초가 되는 설정과 데이터가 올바르게 로드되고 계산되는지 확인합니다.

### **1. 설정 값 검증 (`config/config.py`)**
*   **왜 해야 하나요? (Why)**
    *   설정은 집을 짓기 전의 '설계도'와 같습니다. 설계도가 잘못되면 집 전체가 잘못 지어지는 것처럼, 설정 값이 틀리면 프로그램 전체가 엉뚱하게 동작하거나 오류를 일으킵니다. 그래서 가장 먼저 확인해야 합니다.
*   **어떻게 하나요? (How)**
    1.  `step_by_step_test.py` 파일에 `test_config_values` 라는 테스트 함수를 만듭니다.
    2.  `from config.config import CFG` 코드로 우리가 `.env` 파일에 적어둔 설정들을 불러옵니다.
    3.  `print(CFG.SYMBOL)` 처럼 주요 설정 값들을 하나씩 화면에 출력해봅니다. 그리고 `.env` 파일에 내가 적은 값과 똑같이 나오는지 눈으로 직접 비교합니다.
    4.  **시나리오 테스트**: 일부러 `.env` 파일에서 `BINANCE_API_KEY` 같은 아주 중요한 값을 지우고 프로그램을 실행합니다. 이때 "필수 변수가 설정되지 않았습니다" 같은 똑똑한 오류 메시지를 보여주면서 프로그램이 멈추는지 확인합니다. (오류가 나야 성공!)

### **2. 데이터 수집 및 지표 계산 검증 (`src/data/indicator_repository.py`)**
*   **왜 해야 하나요? (Why)**
    *   봇은 '데이터'라는 밥을 먹고 삽니다. 밥이 신선하고 영양가가 높아야 봇이 건강하게 판단할 수 있습니다. 데이터가 잘못되면 모든 분석과 예측이 틀어지기 때문에, 데이터의 정확성은 생명과도 같습니다.
*   **어떻게 하나요? (How)**
    1.  `step_by_step_test.py`에서 `IndicatorRepository`(데이터 담당 로봇)를 만들고, `get_merged()` 라는 명령으로 데이터를 가져오게 시킵니다.
    2.  **데이터 최신인지 확인**: 가져온 데이터의 마지막 줄을 `df.tail()`로 출력해서, 날짜와 시간이 현재 시간과 비슷한지 확인합니다. (과거 데이터를 가져오면 안 되니까요!)
    3.  **기술적 지표 정확성 확인**:
        *   RSI 라는 중요한 지표 하나를 골라서, 테스트 결과로 나온 숫자와 '트레이딩뷰' 같은 전문가용 차트 사이트의 숫자를 비교해봅니다. (완벽히 똑같지 않아도 비슷하면 괜찮아요!)
        *   `df[['close', 'ema_fast', 'ema_slow', 'rsi', 'macd']].tail(10)` 처럼 주요 지표들을 마지막 10개만 출력해서, 값이 비어있지 않고(`NaN`이 아닌) 제대로 된 숫자가 들어있는지 확인합니다.

---

## Phase 2: 핵심 로직 단위별 검증

> **목표**: 데이터 처리, 모델 예측, 주문 관리 등 핵심 기능들이 각각 혼자서도 일을 잘 하는지 확인합니다. (레고 블록 하나하나가 제대로 만들어졌는지 보는 것과 같아요)

### **3. 머신러닝 모델 단위 테스트 (`src/model/model_service.py`)**
*   **왜 해야 하나요? (Why)**
    *   우리의 봇에는 미래를 예측하는 '인공지능 두뇌(ML 모델)'가 들어있습니다. 이 두뇌가 제대로 학습하고, 똑똑한 예측을 하는지 따로 테스트해야 합니다.
*   **어떻게 하나요? (How)**
    1.  `step_by_step_test.py`에서 `ModelService`(모델 담당 로봇)를 부릅니다.
    2.  `models` 폴더를 싹 비우고, `model.train(df)` 명령을 내려서 학습을 시킵니다. 그러면 `xgb_..._fut.joblib` 라는 '학습 완료 증명서' 파일이 폴더 안에 생기는지 확인합니다.
    3.  학습된 모델에게 `model.add_prob(df)` 명령으로 "내일 비가 올 확률은?" 하고 물어보는 것처럼, 가격이 오를 확률(`prob_up`)을 계산해달라고 합니다. 결과로 나온 확률 값들이 0% ~ 100% (숫자로는 0 ~ 1) 사이에 있는지 확인합니다.

### **4. 주문 관리 단위 테스트 (`src/order/order_service.py` - 모의 거래)**
*   **왜 해야 하나요? (Why)**
    *   이 부분은 실제 돈을 다루는 '지갑'이나 마찬가지입니다. 실제 돈을 넣기 전에, 가짜 돈(모의 거래)으로 수백 번 연습해서 모든 상황에 완벽하게 대처하는지 확인해야 합니다.
*   **어떻게 하나요? (How)**
    1.  `step_by_step_test.py`에서 `OrderService`(주문 담당 로봇)를 `paper=True`(가짜 돈 모드)로 부릅니다.
    2.  **매수 테스트**: `order.open_position(price=50000, qty=0.1, side='long')` 명령으로 "5만 달러에 롱 포지션 0.1개 사줘!" 라고 강제로 시킵니다.
    3.  `print(order.pos)`로 주문 내역을 출력해서, 내가 시킨 대로 가격, 수량, 방향, 그리고 자동으로 계산된 손절/익절 가격이 잘 적혀있는지 확인합니다.
    4.  **손절 테스트**: `order.poll_position_closed(price=49000)` 명령으로 "가격이 4만 9천 달러로 떨어졌어!" 라고 알려줍니다. 그러면 봇이 자동으로 손절하고, 가지고 있던 포지션(`order.pos`)이 사라지는지(`None`으로 바뀌는지) 확인합니다.
    5.  **익절 테스트**: 다시 포지션을 사고, 이번엔 `order.poll_position_closed(price=52000)` 명령으로 "가격이 5만 2천 달러로 올랐어!" 라고 알려줘서, 자동으로 익절하는지 확인합니다.

---

## Phase 3: 전체 흐름 통합 테스트

> **목표**: 각각의 레고 블록들을 모두 합쳐서 '멋진 자동차'가 완성되는 것처럼, 모든 기능들이 함께 잘 작동하는지 최종 확인합니다.

### **5. 전략 및 신호 생성 통합 테스트 (`src/strategy/strategy.py`)**
*   **왜 해야 하나요? (Why)**
    *   데이터, 모델 예측, 규칙이 모두 합쳐져서, 우리가 원하는 바로 '그 순간'에 정확하게 "지금이야! 매수해!" 또는 "지금 팔아!" 라는 신호가 만들어지는지 확인해야 합니다.
*   **어떻게 하나요? (How)**
    1.  `step_by_step_test.py`에서 데이터 가져오기 -> 모델 예측하기 -> 전략 적용하기 순서대로 모두 실행합니다.
    2.  `df_final = Strategy.enrich(df_predicted)`
    3.  `df_final[df_final['long'] == True].tail()` 코드로 'long' 신호가 켜진 순간들을 찾아서 출력합니다. 그리고 그 순간의 조건들(예: `ema_fast > ema_slow`, `rsi < 40`, `prob_up > 0.65`)이 정말 우리가 원했던 조건들과 일치하는지 하나하나 따져봅니다.
    4.  'short' 신호에 대해서도 똑같이 확인합니다.

### **6. 최종 End-to-End 테스트 (`main.py` -> `trading_bot.py`)**
*   **왜 해야 하나요? (Why)**
    *   실제 자동차를 도로에 끌고 나가서 달려보는 것과 같습니다. 실제 프로그램이 돌아가는 환경과 가장 비슷하게 만들어서, 혹시 모를 문제들(스레드 충돌, 데이터 전달 오류 등)을 마지막으로 잡아냅니다.
*   **어떻게 하나요? (How)**
    1.  `.env` 파일에서 `TEST_MODE`를 `true`로, `SLEEP_SEC`를 `5`초 정도로 짧게 설정해서 테스트를 빠르게 진행할 수 있게 합니다.
    2.  `main.py`를 직접 실행해서 프로그램을 켭니다.
    3.  컴퓨터 화면(콘솔)에 나오는 로그 메시지들을 보면서, 봇이 5초마다 "데이터 가져오는 중...", "포지션 상태 확인 중..." 같은 메시지를 잘 보여주는지 5분 정도 지켜봅니다.
    4.  일부러 인터넷 선을 뽑거나 해서 오류를 만들어봅니다. 이때 텔레그램으로 "봇에 문제가 생겼어요!" 라는 에러 메시지가 잘 도착하는지 확인합니다.

---

이 계획에 따라 Phase 1부터 차근차근 진행하여, 봇의 모든 기능을 완벽하게 검증합니다.
